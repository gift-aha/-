<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>明朝那些事儿 - 历史脉络梳理</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #8B0000;
            --secondary-color: #D4AF37;
            --dark-color: #2C1B11;
            --light-color: #F5F5DC;
            --text-color: #333;
            --bg-color: #FFF8F0;
            --card-bg: #FFFFFF;
            --border-color: #D4C8B5;
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'SimSun', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color);
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23FFF8F0"/><path d="M0,0 L100,100 M100,0 L0,100" stroke="%23D4C8B5" stroke-width="0.5" opacity="0.3"/></svg>');
            background-attachment: fixed;
        }
        
        header {
            background: linear-gradient(135deg, var(--dark-color) 0%, var(--primary-color) 100%);
            color: white;
            text-align: center;
            padding: 2rem 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200"><path d="M40,20 L160,20 L160,180 L40,180 Z" fill="none" stroke="%23D4AF37" stroke-width="2" stroke-dasharray="10,5"/><circle cx="100" cy="100" r="60" fill="none" stroke="%23D4AF37" stroke-width="2"/></svg>');
            background-size: 400px;
            opacity: 0.15;
            z-index: 0;
        }
        
        header h1 {
            font-size: 3.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            position: relative;
            z-index: 1;
            letter-spacing: 3px;
        }
        
        header p {
            font-size: 1.3rem;
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        
        .subtitle {
            color: var(--secondary-color);
            font-weight: bold;
        }
        
        nav {
            background-color: var(--dark-color);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .nav-container {
            display: flex;
            justify-content: center;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .nav-tabs {
            display: flex;
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .nav-tabs li {
            position: relative;
        }
        
        .nav-tabs a {
            display: block;
            color: white;
            text-decoration: none;
            padding: 15px 25px;
            font-size: 1.1rem;
            font-weight: 500;
            transition: var(--transition);
            position: relative;
            z-index: 10;
        }
        
        .nav-tabs a:hover, .nav-tabs a.active {
            background-color: var(--primary-color);
        }
        
        .nav-tabs a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--secondary-color);
            transform: scaleX(0);
            transform-origin: right;
            transition: transform 0.3s ease;
            z-index: -1;
        }
        
        .nav-tabs a:hover::after, .nav-tabs a.active::after {
            transform: scaleX(1);
            transform-origin: left;
        }
        
        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1.5rem;
        }
        
        .section {
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--shadow);
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
        }
        
        .section-title {
            color: var(--primary-color);
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
            font-size: 2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: var(--secondary-color);
        }
        
        /* 皇帝世系样式 */
        .emperors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .emperor-card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .emperor-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .emperor-portrait {
            height: 280px;
            background: linear-gradient(45deg, var(--primary-color), var(--dark-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 4rem;
            font-weight: bold;
            position: relative;
            overflow: hidden;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200"><circle cx="100" cy="100" r="80" fill="none" stroke="%23D4AF37" stroke-width="2"/><path d="M60,100 Q100,60 140,100 T60,100" fill="none" stroke="%23D4AF37" stroke-width="1"/></svg>');
            background-size: 100%;
        }
        
        .emperor-portrait img {
            width: 85%;
            height: 85%;
            object-fit: contain;
            border: 3px solid var(--secondary-color);
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .emperor-info {
            padding: 15px;
        }
        
        .emperor-name {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .reign-period {
            color: var(--secondary-color);
            font-weight: bold;
            margin-bottom: 8px;
            display: block;
        }
        
        .emperor-bio {
            font-size: 0.95rem;
            color: #555;
            height: 80px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .read-more {
            display: inline-block;
            color: var(--primary-color);
            font-weight: bold;
            text-decoration: none;
            font-size: 0.9rem;
        }
        
        .read-more:hover {
            text-decoration: underline;
        }
        
        /* 书籍内容样式 */
        .books-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .book-card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .book-cover {
            height: 200px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--dark-color) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3.5rem;
            font-weight: bold;
            position: relative;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200"><rect x="30" y="30" width="140" height="140" fill="none" stroke="%23D4AF37" stroke-width="2"/><path d="M50,100 L150,100 M100,50 L100,150" stroke="%23D4AF37" stroke-width="1" stroke-dasharray="5,5"/></svg>');
            background-size: 60px;
        }
        
        .book-cover::after {
            content: "《明朝那些事儿》";
            position: absolute;
            bottom: 10px;
            font-size: 0.9rem;
            letter-spacing: 3px;
        }
        
        .book-cover span {
            position: relative;
            z-index: 1;
        }
        
        .book-info {
            padding: 20px;
        }
        
        .book-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .book-period {
            color: var(--secondary-color);
            font-weight: bold;
            margin-bottom: 12px;
            display: block;
        }
        
        .book-content {
            font-size: 0.95rem;
            margin-bottom: 15px;
            line-height: 1.7;
        }
        
        .key-figures {
            margin-top: 15px;
        }
        
        .key-figures h4 {
            font-size: 1.1rem;
            color: var(--dark-color);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .figures-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .figure-tag {
            background-color: #e9ecef;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.85rem;
            color: var(--primary-color);
        }
        
        /* 人物关系图样式 */
        .relationship-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 30px;
        }
        
        #relationship-chart {
            width: 100%;
            height: 500px;
            background-color: var(--light-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            margin-top: 20px;
            box-shadow: var(--shadow);
        }
        
        .person-card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-top: 25px;
            box-shadow: var(--shadow);
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .person-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 15px;
        }
        
        .person-avatar {
            width: 100px;
            height: 100px;
            background: linear-gradient(45deg, var(--primary-color), var(--dark-color));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2.5rem;
            font-weight: bold;
            margin-right: 25px;
            flex-shrink: 0;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="none" stroke="%23D4AF37" stroke-width="1"/></svg>');
            background-size: 80%;
        }
        
        .person-name {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .person-title {
            color: var(--secondary-color);
            font-weight: bold;
            margin-top: 5px;
        }
        
        .person-bio {
            line-height: 1.8;
            margin-bottom: 20px;
        }
        
        .key-events {
            margin-top: 20px;
        }
        
        .key-events h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .event-item {
            background-color: #f8f9fa;
            padding: 12px 15px;
            border-left: 4px solid var(--secondary-color);
            margin-bottom: 10px;
            border-radius: 0 4px 4px 0;
        }
        
        /* 战役推演样式 */
        .battle-container {
            margin-top: 30px;
        }
        
        .battle-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 25px 0;
            flex-wrap: wrap;
        }
        
        .battle-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .battle-btn:hover {
            background-color: #a52a2a;
            transform: translateY(-2px);
        }
        
        .battle-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .battle-map-container {
            background-color: var(--light-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin: 25px 0;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }
        
        .battle-map {
            width: 100%;
            height: 450px;
            background: linear-gradient(to bottom, #e6d3a7 0%, #c1b18a 100%);
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.2);
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="300" viewBox="0 0 400 300"><path d="M50,250 L350,250 L350,50 L50,50 Z" fill="none" stroke="%238B4513" stroke-width="2"/><path d="M150,150 L250,150 M200,100 L200,200" stroke="%238B4513" stroke-width="1" stroke-dasharray="5,5"/><circle cx="100" cy="200" r="15" fill="%23D4AF37" opacity="0.7"/><circle cx="300" cy="100" r="15" fill="%234a6b3f" opacity="0.7"/><text x="100" y="205" font-family="SimSun" font-size="12" fill="%23333" text-anchor="middle">南京</text><text x="300" y="105" font-family="SimSun" font-size="12" fill="%23333" text-anchor="middle">北平</text></svg>');
            background-size: 100%;
        }
        
        .army {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            z-index: 10;
            transition: all 0.8s ease;
        }
        
        .ming-army {
            background-color: var(--primary-color);
        }
        
        .enemy-army {
            background-color: #4a6b3f;
        }
        
        .battle-label {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 20;
        }
        
        .battle-step {
            background-color: var(--card-bg);
            border-left: 4px solid var(--secondary-color);
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
            box-shadow: var(--shadow);
        }
        
        .battle-step h4 {
            color: var(--primary-color);
            margin-bottom: 8px;
        }
        
        /* 检索功能样式 */
        .search-container {
            max-width: 700px;
            margin: 30px auto;
            position: relative;
        }
        
        .search-box {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid var(--border-color);
            border-radius: 50px;
            font-size: 1.1rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .search-box:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(139, 0, 0, 0.2);
        }
        
        .search-results {
            margin-top: 30px;
        }
        
        .result-card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .result-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }
        
        .result-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .result-type {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.85rem;
            margin-right: 10px;
        }
        
        .result-type.emperor {
            background-color: var(--secondary-color);
            color: var(--dark-color);
        }
        
        .result-type.battle {
            background-color: #4a6b3f;
            color: white;
        }
        
        .result-type.book {
            background-color: #6a4c93;
            color: white;
        }
        
        .result-content {
            line-height: 1.7;
        }
        
        .timeline {
            position: relative;
            max-width: 800px;
            margin: 40px auto;
            padding-left: 30px;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 15px;
            width: 4px;
            background-color: var(--primary-color);
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: 30px;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -28px;
            top: 5px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            border: 3px solid var(--primary-color);
        }
        
        .timeline-date {
            position: absolute;
            left: -120px;
            top: 0;
            width: 80px;
            text-align: right;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .timeline-content {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            box-shadow: var(--shadow);
        }
        
        .timeline-title {
            font-weight: bold;
            color: var(--dark-color);
            margin-bottom: 5px;
        }
        
        /* 页脚样式 */
        footer {
            background: linear-gradient(135deg, var(--dark-color) 0%, var(--primary-color) 100%);
            color: white;
            text-align: center;
            padding: 25px 15px;
            margin-top: 30px;
            font-size: 0.95rem;
        }
        
        .footer-content {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .footer-links a {
            color: var(--secondary-color);
            text-decoration: none;
            transition: var(--transition);
        }
        
        .footer-links a:hover {
            color: white;
            text-decoration: underline;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            header h1 {
                font-size: 2.5rem;
            }
            
            header p {
                font-size: 1.1rem;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
            }
            
            .nav-tabs a {
                padding: 12px 15px;
                font-size: 0.95rem;
            }
            
            .section {
                padding: 1.5rem;
            }
            
            .emperors-grid, .books-container {
                grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            }
            
            .battle-map {
                height: 350px;
            }
            
            .timeline::before {
                left: 10px;
            }
            
            .timeline-date {
                left: -100px;
                font-size: 0.9rem;
            }
            
            .timeline-item::before {
                left: -23px;
            }
        }
        
        @media (max-width: 480px) {
            header h1 {
                font-size: 2rem;
            }
            
            .nav-tabs a {
                padding: 10px 12px;
                font-size: 0.9rem;
            }
            
            .section-title {
                font-size: 1.7rem;
            }
            
            .emperor-portrait {
                height: 220px;
                font-size: 3rem;
            }
            
            .book-cover {
                height: 170px;
                font-size: 2.5rem;
            }
            
            .battle-map {
                height: 280px;
            }
            
            .timeline {
                padding-left: 20px;
                margin: 25px auto;
            }
            
            .timeline::before {
                left: 8px;
            }
            
            .timeline-date {
                left: -80px;
                font-size: 0.85rem;
            }
            
            .timeline-item::before {
                left: -21px;
            }
        }
        
        /* 皇帝详细信息模态框 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: var(--card-bg);
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            animation: modalopen 0.4s;
        }
        
        @keyframes modalopen {
            from {opacity: 0; transform: translateY(-50px);}
            to {opacity: 1; transform: translateY(0);}
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 1.5rem;
            color: var(--primary-color);
            cursor: pointer;
            font-weight: bold;
            transition: var(--transition);
        }
        
        .close-modal:hover {
            color: var(--dark-color);
            transform: scale(1.2);
        }
        
        .modal-header {
            background: linear-gradient(135deg, var(--dark-color) 0%, var(--primary-color) 100%);
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 10px 10px 0 0;
        }
        
        .modal-body {
            padding: 25px;
        }
        
        .emperor-full-name {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .emperor-reign {
            font-size: 1.3rem;
            color: var(--secondary-color);
            margin-bottom: 15px;
            display: block;
        }
        
        .emperor-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .detail-item {
            margin-bottom: 15px;
        }
        
        .detail-label {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .emperor-full-bio {
            margin-top: 25px;
            line-height: 1.8;
        }
        
        /* 战役步骤指示器 */
        .step-indicator {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .step-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #ccc;
            transition: var(--transition);
        }
        
        .step-dot.active {
            background-color: var(--primary-color);
            transform: scale(1.3);
        }
        
        .step-dot.completed {
            background-color: var(--secondary-color);
        }
        mark.search-highlight {
            background: linear-gradient(120deg, rgba(255,215,0,0.4) 0%, rgba(255,193,7,0.6) 100%);
            padding: 0 2px;
            border-radius: 2px;
            font-weight: 600;
            box-shadow: 0 0 0 1px rgba(255,193,7,0.5);
        }
        /* 卡片悬停动效（所有卡片统一） */
        .book-card, .emperor-card, .person-card, .result-card {
            transition: transform 0.35s cubic-bezier(0.175, 0.885, 0.32, 1.275), 
                        box-shadow 0.4s ease;
        }
        .book-card:hover, .emperor-card:hover, .person-card:hover, .result-card:hover {
            transform: translateY(-6px) scale(1.01);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.18) !important;
            z-index: 10;
        }
            
        /* 返回顶部按钮增强 */
        .back-to-top {
            background: linear-gradient(135deg, var(--primary-color), #1a3a6c);
            animation: pulse 2s infinite;
        }
        .back-to-top:hover {
            animation: none;
            transform: translateY(-5px) scale(1.1);
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(26, 58, 108, 0.4); }
            70% { box-shadow: 0 0 0 12px rgba(26, 58, 108, 0); }
            100% { box-shadow: 0 0 0 0 rgba(26, 58, 108, 0); }
        }
            
        /* 人物关系节点优化 */
        .relationship-node {
            transition: all 0.3s ease !important;
            position: relative;
            z-index: 2;
        }
        .relationship-node:hover {
            transform: scale(1.15) translateY(-3px) !important;
            z-index: 100 !important;
            box-shadow: 0 5px 25px rgba(0,0,0,0.25) !important;
        }
        /* ===== 深色模式系统 ===== */
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --text-primary: #212529;
            --text-secondary: #495057;
            --border-color: #dee2e6;
            --card-bg: #ffffff;
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
            --timeline-bg: linear-gradient(to right, #e3f2fd, #bbdefb);
        }
        
        [data-theme="dark"] {
            --bg-primary: #121212;
            --bg-secondary: #1e1e1e;
            --text-primary: #f8f9fa;
            --text-secondary: #adb5bd;
            --border-color: #333;
            --card-bg: #1a1a1a;
            --shadow: 0 4px 20px rgba(0,0,0,0.35);
            --timeline-bg: linear-gradient(to right, #0a1929, #1a2a4a);
            --primary-color: #4da6ff; /* 深色模式主色微调 */
        }
        
        /* 全局深色适配 */
        [data-theme="dark"] body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
        }
        [data-theme="dark"] .battle-map, 
        [data-theme="dark"] .search-container,
        [data-theme="dark"] .modal-content {
            background: var(--card-bg);
            border-color: var(--border-color);
        }
        [data-theme="dark"] .army {
            box-shadow: 0 0 8px rgba(255,255,255,0.15);
        }
        [data-theme="dark"] .step-dot.active {
            background: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(77, 166, 255, 0.3);
        }
        [data-theme="dark"] mark.search-highlight {
            background: rgba(255, 215, 0, 0.25) !important;
            color: #fff !important;
        }
        [data-theme="dark"] .timeline-item::before {
            background: rgba(255,255,255,0.08);
        }
        [data-theme="dark"] .timeline-dot {
            box-shadow: 0 0 0 4px rgba(77, 166, 255, 0.25);
        }
        [data-theme="dark"] .nav-menu a:hover,
        [data-theme="dark"] .nav-menu a.active {
            color: var(--primary-color);
        }
        [data-theme="dark"] .relationship-node {
            border-color: rgba(255,255,255,0.1);
            background: rgba(30,30,30,0.7);
        }
        [data-theme="dark"] .back-to-top {
            background: linear-gradient(135deg, #1a3a6c, #0d2a52);
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }
        /* ===== 响应式设计 ===== */
        @media (max-width: 992px) {
            .nav-menu { display: none; }
            .battle-controls { flex-direction: column; gap: 10px; }
            .battle-btn { width: 100%; }
            .timeline-container { padding: 0 20px; }
            .timeline-item { width: 100% !important; margin: 25px 0 !important; }
            .timeline-item.left, .timeline-item.right { 
                padding-left: 60px !important; 
                text-align: left !important;
            }
            .timeline-item::before { left: 30px !important; }
            .timeline-dot { left: 24px !important; }
        }
        
        @media (max-width: 768px) {
            .main-nav { padding: 8px 15px; }
            .nav-logo .site-title { display: none; }
            .dynasty-mark { font-size: 1.4rem; padding: 2px 8px; }
            .section-title { font-size: 1.6rem; }
            .battle-map { height: 300px; }
            .army { width: 28px; height: 28px; font-size: 10px; }
            .search-container { flex-direction: column; }
            #searchInput { width: 100%; margin-bottom: 10px; }
            .book-grid, .emperor-grid, .person-grid { grid-template-columns: repeat(2, 1fr); }
        }
        
        @media (max-width: 480px) {
            .book-grid, .emperor-grid, .person-grid { grid-template-columns: 1fr; }
            .timeline-legend { flex-wrap: wrap; font-size: 0.85rem; }
            .timeline-legend span { margin: 3px 8px; }
            .modal-content { width: 95%; max-width: 400px; }
            .relationship-node { padding: 8px 10px; font-size: 0.85rem; }
        }
        /* ===== 新增全局样式 ===== */
        .main-nav {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: rgba(255,255,255,0.95);
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        [data-theme="dark"] .main-nav {
            background: rgba(18,18,18,0.92);
            box-shadow: 0 2px 20px rgba(0,0,0,0.3);
        }
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
        }
        .nav-logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
        }
        .dynasty-mark {
            background: var(--primary-color);
            color: white;
            padding: 2px 10px;
            border-radius: 4px;
            font-family: 'SimSun', serif;
            letter-spacing: 1px;
            font-size: 1.3rem;
        }
        .site-title {
            font-size: 1.5rem;
            color: var(--text-primary);
            font-family: 'Microsoft YaHei', sans-serif;
        }
        .nav-menu {
            display: flex;
            list-style: none;
            gap: 25px;
        }
        .nav-menu a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            padding: 5px 0;
            position: relative;
            transition: color 0.2s;
        }
        .nav-menu a:hover, .nav-menu a.active {
            color: var(--primary-color);
        }
        .nav-menu a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--primary-color);
            transition: width 0.3s ease;
        }
        .nav-menu a:hover::after, .nav-menu a.active::after {
            width: 100%;
        }
        .nav-actions { display: flex; gap: 12px; }
        .theme-btn, .search-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: var(--bg-secondary);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: var(--shadow);
        }
        .theme-btn:hover { transform: rotate(30deg); }
        .search-btn:hover { background: var(--primary-color); color: white; }
        
        /* 时间轴样式 */
        .timeline-section { padding: 60px 20px; background: var(--timeline-bg); }
        .timeline-container {
            position: relative;
            max-width: 1000px;
            margin: 40px auto;
            padding-left: 40px;
        }
        .timeline-container::before {
            content: '';
            position: absolute;
            left: 40px;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--primary-color);
            border-radius: 2px;
        }
        .timeline-item {
            position: relative;
            width: calc(50% - 40px);
            margin: 30px 0;
            padding-left: 60px;
        }
        .timeline-item.left { left: 0; text-align: right; }
        .timeline-item.right { left: calc(50% + 40px); }
        .timeline-dot {
            position: absolute;
            left: -28px;
            top: 20px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            border: 4px solid white;
            box-shadow: 0 0 0 4px var(--primary-color);
            z-index: 1;
        }
        .timeline-content {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            transition: transform 0.3s ease;
        }
        .timeline-content:hover { transform: translateY(-5px); }
        .timeline-year {
            position: absolute;
            left: -100px;
            top: 15px;
            width: 60px;
            height: 60px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.4rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .timeline-item.right .timeline-year { left: auto; right: -100px; }
        .timeline-tag {
            display: inline-block;
            margin-top: 12px;
            padding: 3px 10px;
            background: rgba(77, 166, 255, 0.15);
            color: var(--primary-color);
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        .timeline-legend {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        .timeline-legend span { display: flex; align-items: center; gap: 6px; }
        
        /* 页脚样式 */
        .site-footer {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
            color: var(--text-secondary);
            padding: 50px 20px 20px;
            margin-top: 40px;
            border-top: 1px solid var(--border-color);
        }
        .footer-container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 30px;
        }
        .footer-section h4 {
            color: var(--text-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.3rem;
        }
        .footer-section ul { list-style: none; padding: 0; }
        .footer-section li {
            padding: 6px 0;
            border-bottom: 1px dashed var(--border-color);
            transition: color 0.2s;
        }
        .footer-section li:hover { color: var(--primary-color); }
        .footer-section a { color: var(--text-secondary); text-decoration: none; }
        .footer-section a:hover { color: var(--primary-color); }
        .copyright { text-align: center; grid-column: span 2; }
        .dynasty-seal {
            width: 80px;
            height: 80px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-family: 'SimSun', serif;
            font-size: 1.8rem;
            letter-spacing: 2px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .footer-note { 
            font-size: 0.85rem; 
            color: var(--text-secondary); 
            margin-top: 8px;
            line-height: 1.5;
        }
        .footer-meta {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .footer-meta span {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
            padding: 4px 12px;
            background: rgba(77, 166, 255, 0.1);
            border-radius: 20px;
        }
        .footer-bottom {
            max-width: 1200px;
            margin: 30px auto 0;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <header>
        <h1>明朝那些事儿</h1>
        <p>一部轻松幽默的历史读物，带你走进<span class="subtitle">大明王朝</span>的兴衰荣辱</p>
    </header>

        <!-- 顶部导航栏 -->
    <nav class="main-nav">
        <div class="nav-container">
            <div class="nav-logo">
                <span class="dynasty-mark">MING</span>
                <span class="site-title">大明史鉴</span>
            </div>
            <ul class="nav-menu">
                <li><a href="#timeline" class="active">大事记</a></li>
                <li><a href="#emperors">帝王谱</a></li>
                <li><a href="#battles">战役录</a></li>
                <li><a href="#figures">风云录</a></li>
                <li><a href="#archives">典籍库</a></li>
                <li><a href="#map" class="premium">疆域图</a></li>
            </ul>
            <div class="nav-actions">
                <button id="themeToggle" class="theme-btn" title="切换深色模式">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="search-btn" onclick="document.getElementById('searchInput').focus()">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>
    </nav>
        <!-- 历史时间轴 -->
    <section id="timeline" class="timeline-section">
        <div class="section-title">
            <i class="fas fa-history"></i> 大明二七六载 · 关键纪事
        </div>
        <div class="timeline-container">
            <div class="timeline-item left">
                <div class="timeline-content">
                    <div class="timeline-year">1368</div>
                    <h3>洪武开国</h3>
                    <p>朱元璋于应天府称帝，国号大明，年号洪武。北伐驱逐蒙元，收复燕云十六州。</p>
                    <div class="timeline-tag">开国奠基</div>
                </div>
                <div class="timeline-dot"></div>
            </div>
            <div class="timeline-item right">
                <div class="timeline-content">
                    <div class="timeline-year">1402</div>
                    <h3>永乐登基</h3>
                    <p>靖难之役结束，朱棣攻入南京即位。次年改元永乐，开启"永乐盛世"。</p>
                    <div class="timeline-tag">政权更迭</div>
                </div>
                <div class="timeline-dot"></div>
            </div>
            <div class="timeline-item left">
                <div class="timeline-content">
                    <div class="timeline-year">1449</div>
                    <h3>土木堡之变</h3>
                    <p>明英宗亲征瓦剌被俘，20万精锐覆灭。于谦力挽狂澜，组织北京保卫战。</p>
                    <div class="timeline-tag">国运转折</div>
                </div>
                <div class="timeline-dot"></div>
            </div>
            <div class="timeline-item right">
                <div class="timeline-content">
                    <div class="timeline-year">1572</div>
                    <h3>万历中兴</h3>
                    <p>张居正推行"一条鞭法"，整顿吏治，国库充盈，史称"万历中兴"。</p>
                    <div class="timeline-tag">改革巅峰</div>
                </div>
                <div class="timeline-dot"></div>
            </div>
            <div class="timeline-item left">
                <div class="timeline-content">
                    <div class="timeline-year">1644</div>
                    <h3>甲申国殇</h3>
                    <p>李自成破北京，崇祯帝自缢煤山。吴三桂引清兵入关，明朝灭亡。</p>
                    <div class="timeline-tag">王朝终章</div>
                </div>
                <div class="timeline-dot"></div>
            </div>
        </div>
        <div class="timeline-legend">
            <span><i class="fas fa-circle" style="color:#e74c3c"></i> 政权更迭</span>
            <span><i class="fas fa-circle" style="color:#3498db"></i> 改革巅峰</span>
            <span><i class="fas fa-circle" style="color:#2ecc71"></i> 国运转折</span>
            <span><i class="fas fa-circle" style="color:#9b59b6"></i> 开国奠基</span>
        </div>
    </section>
    <nav>
        <div class="nav-container">
            <ul class="nav-tabs">
                <li><a href="#overview" class="active"><i class="fas fa-home"></i> 概览</a></li>
                <li><a href="#books"><i class="fas fa-book"></i> 书籍内容</a></li>
                <li><a href="#emperors"><i class="fas fa-crown"></i> 皇帝世系</a></li>
                <li><a href="#figures"><i class="fas fa-user-friends"></i> 风云人物</a></li>
                <li><a href="#battles"><i class="fas fa-crosshairs"></i> 战役推演</a></li>
                <li><a href="#search"><i class="fas fa-search"></i> 事件检索</a></li>
            </ul>
        </div>
    </nav>
    
    <div class="container">
        <section id="overview" class="section">
            <h2 class="section-title"><i class="fas fa-chart-line"></i> 明朝历史脉络</h2>
            <p>《明朝那些事儿》是当年明月创作的历史小说，以幽默风趣的笔法讲述了从1344年到1644年这三百年间明朝的历史。本书共七部，以史料为基础，以年代和具体人物为主线，同时加入了小说的笔法，对明朝十七帝和其他王公权贵以及小人物的命运进行了全景展示。</p>
            
            <div class="timeline">
                <div class="timeline-item">
                    <div class="timeline-date">1344年</div>
                    <div class="timeline-content">
                        <div class="timeline-title">朱元璋出生</div>
                        <p>朱元璋出生于濠州钟离（今安徽凤阳）一个贫苦农民家庭，幼名朱重八。</p>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-date">1368年</div>
                    <div class="timeline-content">
                        <div class="timeline-title">明朝建立</div>
                        <p>朱元璋在应天府（今南京）称帝，国号大明，年号洪武，建立明朝。</p>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-date">1402年</div>
                    <div class="timeline-content">
                        <div class="timeline-title">靖难之役</div>
                        <p>燕王朱棣攻入南京，建文帝失踪，朱棣即位为明成祖，开启永乐盛世。</p>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-date">1421年</div>
                    <div class="timeline-content">
                        <div class="timeline-title">迁都北京</div>
                        <p>明成祖朱棣正式迁都北京，南京作为留都，形成两京制。</p>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-date">1449年</div>
                    <div class="timeline-content">
                        <div class="timeline-title">土木堡之变</div>
                        <p>明英宗朱祁镇亲征瓦剌被俘，明朝精锐损失惨重，京城危在旦夕。</p>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-date">1573-1620年</div>
                    <div class="timeline-content">
                        <div class="timeline-title">万历中兴</div>
                        <p>张居正改革带来明朝最后的辉煌，但万历后期怠政导致国力衰退。</p>
                    </div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-date">1644年</div>
                    <div class="timeline-content">
                        <div class="timeline-title">明朝灭亡</div>
                        <p>李自成攻入北京，崇祯帝自缢于煤山，明朝灭亡，清军入关。</p>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="books" class="section">
            <h2 class="section-title"><i class="fas fa-book-open"></i> 书籍内容梳理</h2>
            <p>《明朝那些事儿》共七部，全面讲述了明朝276年的历史。以下是各部主要内容及涉及的重要人物和事件：</p>
            
            <div class="books-container">
                <div class="book-card">
                    <div class="book-cover"><span>壹</span></div>
                    <div class="book-info">
                        <div class="book-title">洪武大帝</div>
                        <span class="book-period">1344年 - 1398年</span>
                        <p class="book-content">讲述朱元璋从放牛娃到开国皇帝的传奇历程，包括起义、统一战争、建立明朝、洪武之治及晚年诛杀功臣等事件。</p>
                        <div class="key-figures">
                            <h4><i class="fas fa-user"></i> 核心人物</h4>
                            <div class="figures-list">
                                <span class="figure-tag">朱元璋</span>
                                <span class="figure-tag">徐达</span>
                                <span class="figure-tag">常遇春</span>
                                <span class="figure-tag">刘伯温</span>
                                <span class="figure-tag">马皇后</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="book-card">
                    <div class="book-cover"><span>贰</span></div>
                    <div class="book-info">
                        <div class="book-title">万国来朝</div>
                        <span class="book-period">1398年 - 1424年</span>
                        <p class="book-content">聚焦靖难之役、朱棣夺位、永乐盛世、郑和下西洋、迁都北京等重大事件，展现明朝鼎盛时期的恢弘气象。</p>
                        <div class="key-figures">
                            <h4><i class="fas fa-user"></i> 核心人物</h4>
                            <div class="figures-list">
                                <span class="figure-tag">朱棣</span>
                                <span class="figure-tag">朱允炆</span>
                                <span class="figure-tag">姚广孝</span>
                                <span class="figure-tag">郑和</span>
                                <span class="figure-tag">解缙</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="book-card">
                    <div class="book-cover"><span>叁</span></div>
                    <div class="book-info">
                        <div class="book-title">妖孽宫廷</div>
                        <span class="book-period">1424年 - 1464年</span>
                        <p class="book-content">讲述仁宣之治的短暂辉煌，土木堡之变的惨痛教训，于谦保卫北京的壮举，以及夺门之变等宫廷斗争。</p>
                        <div class="key-figures">
                            <h4><i class="fas fa-user"></i> 核心人物</h4>
                            <div class="figures-list">
                                <span class="figure-tag">朱瞻基</span>
                                <span class="figure-tag">朱祁镇</span>
                                <span class="figure-tag">于谦</span>
                                <span class="figure-tag">王振</span>
                                <span class="figure-tag">朱祁钰</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 25px; padding: 15px; background-color: #f8f9fa; border-radius: 8px; border: 1px dashed var(--border-color);">
                <p>📚 <strong>完整七部内容：</strong> 洪武大帝 → 万国来朝 → 妖孽宫廷 → 粉饰太平 → 帝国飘摇 → 日暮西山 → 大结局</p>
                <p style="margin-top: 8px; color: var(--primary-color); font-weight: bold;">涵盖明朝276年历史，17位皇帝，数百位历史人物</p>
            </div>
        </section>
        
        <section id="emperors" class="section">
            <h2 class="section-title"><i class="fas fa-crown"></i> 明朝皇帝世系</h2>
            <p>明朝共十六位皇帝（建文帝未被承认，景泰帝后被复辟），以下为完整世系及简介。点击皇帝卡片查看详细生平。</p>
            
            <div class="emperors-grid">
                <div class="emperor-card" onclick="openEmperorModal('朱元璋', '明太祖', '1368-1398', '洪武', '明朝开国皇帝，年号洪武。出身贫农，25岁参加郭子兴起义军，后逐步统一全国。在位期间实行休养生息政策，恢复社会生产，史称洪武之治。晚年大杀功臣，为子孙铺路。', '驱逐胡虏，恢复中华，立纲陈纪，救济斯民', '1328-1398', '安徽凤阳', '马皇后', '诛杀胡惟庸、蓝玉等功臣，设立锦衣卫')">
                    <div class="emperor-portrait">🐉</div>
                    <div class="emperor-info">
                        <div class="emperor-name">朱元璋</div>
                        <span class="reign-period">洪武 (1368-1398)</span>
                        <p class="emperor-bio">明朝开国皇帝，从乞丐到皇帝的传奇。建立明朝后推行休养生息政策，恢复社会经济，但晚年大杀功臣。</p>
                        <a href="#" class="read-more">查看详情 →</a>
                    </div>
                </div>
                
                <div class="emperor-card" onclick="openEmperorModal('朱棣', '明成祖', '1402-1424', '永乐', '朱元璋第四子，初封燕王。发动靖难之役夺取皇位，年号永乐。在位期间迁都北京，派郑和下西洋，编纂《永乐大典》，五征蒙古，开创永乐盛世。', '天命有归，朕当为天下主', '1360-1424', '南京（生于）', '徐皇后', '迁都北京、郑和下西洋、五征蒙古')">
                    <div class="emperor-portrait">🐉</div>
                    <div class="emperor-info">
                        <div class="emperor-name">朱棣</div>
                        <span class="reign-period">永乐 (1402-1424)</span>
                        <p class="emperor-bio">通过靖难之役夺取皇位，开创永乐盛世。迁都北京，派郑和下西洋，编纂《永乐大典》，是明朝最具影响力的皇帝之一。</p>
                        <a href="#" class="read-more">查看详情 →</a>
                    </div>
                </div>
                
                <div class="emperor-card" onclick="openEmperorModal('朱瞻基', '明宣宗', '1425-1435', '宣德', '朱高炽长子，幼年深得祖父朱棣喜爱。在位期间政治清明，百姓安居乐业，与父亲的统治时期合称“仁宣之治”。擅长书画，有“宣德炉”传世。', '朕承天命，抚育万民', '1399-1435', '北平', '孙皇后', '平定汉王朱高煦叛乱，休养生息')">
                    <div class="emperor-portrait">🐉</div>
                    <div class="emperor-info">
                        <div class="emperor-name">朱瞻基</div>
                        <span class="reign-period">宣德 (1425-1435)</span>
                        <p class="emperor-bio">与其父朱高炽共创"仁宣之治"，明朝国力达到鼎盛。擅长书画，政治清明，但为后世埋下宦官专权隐患。</p>
                        <a href="#" class="read-more">查看详情 →</a>
                    </div>
                </div>
                
                <div class="emperor-card" onclick="openEmperorModal('朱祁镇', '明英宗', '1435-1449, 1457-1464', '正统/天顺', '9岁即位，前期由"三杨"辅政。后宠信宦官王振导致土木堡之变被俘。被放回后发动夺门之变复辟，处死于谦。是明朝唯一使用两个年号的皇帝。', '天命靡常，惟德是辅', '1427-1464', '北京', '钱皇后', '土木堡之变、夺门之变、处死于谦')">
                    <div class="emperor-portrait">🐉</div>
                    <div class="emperor-info">
                        <div class="emperor-name">朱祁镇</div>
                        <span class="reign-period">正统/天顺 (1435-1449, 1457-1464)</span>
                        <p class="emperor-bio">经历被俘、软禁、复辟的传奇皇帝。土木堡之变导致明朝精锐尽失，复辟后处死功臣于谦，一生充满戏剧性。</p>
                        <a href="#" class="read-more">查看详情 →</a>
                    </div>
                </div>
                
                <div class="emperor-card" onclick="openEmperorModal('朱厚熜', '明世宗', '1521-1566', '嘉靖', '以藩王身份继位，通过大礼议事件强化皇权。前期勤政有为，后期沉迷道教，二十多年不上朝。严嵩专权，倭寇肆虐，但明朝根基未动摇。', '朕乃真命天子，当享万世', '1507-1567', '湖北钟祥', '陈皇后', '大礼议、严嵩专权、抗倭战争')">
                    <div class="emperor-portrait">🐉</div>
                    <div class="emperor-info">
                        <div class="emperor-name">朱厚熜</div>
                        <span class="reign-period">嘉靖 (1521-1566)</span>
                        <p class="emperor-bio">通过大礼议事件确立权威，前期有为后期昏庸。沉迷道教方术，严嵩专权二十年，但明朝制度韧性使其统治长达45年。</p>
                        <a href="#" class="read-more">查看详情 →</a>
                    </div>
                </div>
                
                <div class="emperor-card" onclick="openEmperorModal('朱由检', '明思宗', '1627-1644', '崇祯', '明朝末代皇帝，勤政廉政却无力回天。在位17年更换50位内阁大学士，诛杀袁崇焕，面对内忧外患。1644年李自成攻入北京，自缢于煤山。', '朕非亡国之君，诸臣皆亡国之臣', '1611-1644', '北京', '周皇后', '诛杀魏忠贤、处死袁崇焕、自缢煤山')">
                    <div class="emperor-portrait">🐉</div>
                    <div class="emperor-info">
                        <div class="emperor-name">朱由检</div>
                        <span class="reign-period">崇祯 (1627-1644)</span>
                        <p class="emperor-bio">明朝最后一位皇帝，勤政却刚愎多疑。面对内忧外患无力回天，1644年李自成攻破北京，自缢殉国，明朝灭亡。</p>
                        <a href="#" class="read-more">查看详情 →</a>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 25px; padding: 15px; background-color: #f8f9fa; border-radius: 8px; border: 1px dashed var(--border-color);">
                <p>👑 <strong>完整皇帝世系：</strong> 朱元璋 → 朱允炆(建文) → 朱棣 → 朱高炽 → 朱瞻基 → 朱祁镇 → 朱祁钰(景泰) → 朱见深 → 朱祐樘 → 朱厚照 → 朱厚熜 → 朱载坖 → 朱翊钧 → 朱常洛 → 朱由校 → 朱由检</p>
                <p style="margin-top: 8px; color: var(--primary-color); font-weight: bold;">16位皇帝，276年国祚（1368-1644）</p>
            </div>
        </section>
        
        <section id="figures" class="section">
            <h2 class="section-title"><i class="fas fa-user-friends"></i> 风云人物关系</h2>
            <p>明朝历史中涌现出众多影响历史进程的人物，以下为关键人物关系网络及生平简介：</p>
            
            <div class="relationship-container">
                <div style="background: linear-gradient(135deg, var(--primary-color) 0%, var(--dark-color) 100%); color: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center; font-weight: bold;">
                    <i class="fas fa-sitemap"></i> 人物关系网络图（点击节点查看详情）
                </div>
                <div id="relationship-chart"></div>
                
                <div class="person-card">
                    <div class="person-header">
                        <div class="person-avatar">🛡️</div>
                        <div>
                            <div class="person-name">于谦</div>
                            <div class="person-title">民族英雄 · 兵部尚书</div>
                        </div>
                    </div>
                    <p class="person-bio">字廷益，号节庵，浙江钱塘人。明朝名臣、民族英雄。土木堡之变后，英宗被俘，京城危殆，于谦力排南迁之议，拥立景泰帝，整饬兵备，部署要害，亲自督战，率师二十二万，列阵北京九门外，大破瓦剌，保卫北京城。后英宗复辟，于谦被诬陷处死，抄家时"家无余资"，后平反昭雪。</p>
                    
                    <div class="key-events">
                        <h3><i class="fas fa-history"></i> 关键事件</h3>
                        <div class="event-item">• 1449年：土木堡之变后临危受命，组织北京保卫战</div>
                        <div class="event-item">• 1450年：成功击退瓦剌大军，保全明朝江山</div>
                        <div class="event-item">• 1457年：夺门之变后被诬陷处死，遗言"粉身碎骨浑不怕，要留清白在人间"</div>
                        <div class="event-item">• 1466年：明宪宗为其平反，追谥"忠肃"</div>
                    </div>
                </div>
                
                <div class="person-card" style="margin-top: 25px;">
                    <div class="person-header">
                        <div class="person-avatar">🧭</div>
                        <div>
                            <div class="person-name">郑和</div>
                            <div class="person-title">航海家 · 外交家</div>
                        </div>
                    </div>
                    <p class="person-bio">原姓马，小名三保，云南昆阳人。明朝航海家、外交家。本为燕王朱棣侍卫，靖难之役中立功，赐姓郑。1405-1433年七下西洋，拜访30多个国家和地区，最远到达东非、红海。船队规模庞大，技术先进，促进海上丝绸之路繁荣。其航海壮举比哥伦布早87年，是世界航海史上的奇迹。</p>
                    
                    <div class="key-events">
                        <h3><i class="fas fa-history"></i> 关键事件</h3>
                        <div class="event-item">• 1381年：明军平定云南时被俘，入宫为宦官</div>
                        <div class="event-item">• 1405-1433年：七次率领庞大船队下西洋，最远至非洲</div>
                        <div class="event-item">• 1431年：第七次下西洋前在福建长乐立《天妃灵应之记碑》</div>
                        <div class="event-item">• 1435年：病逝于南京，葬于牛首山</div>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="battles" class="section">
            <h2 class="section-title"><i class="fas fa-crosshairs"></i> 经典战役推演</h2>
            <p>通过动态地图推演明朝关键战役的战略部署与战场形势，深度解析历史转折点：</p>
            
            <div class="battle-container">
                <div style="text-align: center; margin-bottom: 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 15px; border-radius: 10px; border: 1px solid var(--border-color);">
                    <div style="display: flex; justify-content: center; align-items: center; gap: 15px; flex-wrap: wrap;">
                        <h3 style="color: var(--primary-color); margin: 0; font-size: 1.4rem;">
                            <i class="fas fa-map-marked-alt"></i> <span id="battleTitle">靖难之役 · 北平保卫战（1399年）</span>
                        </h3>
                        <select id="battleSelect" class="battle-btn" style="padding: 6px 12px; background: white; border: 1px solid var(--primary-color); border-radius: 20px; font-weight: 500;">
                            <option value="jingnan">⚔️ 靖难之役</option>
                            <option value="tumu">🛡️ 土木堡之变</option>
                            <option value="beijing">🏯 北京保卫战</option>
                            <option value="salarhu">🔥 萨尔浒之战</option>
                        </select>
                    </div>
                    <p style="color: #495057; margin-top: 10px; max-width: 750px; margin-left: auto; margin-right: auto;" id="battleDescription">
                        燕王朱棣起兵反抗建文帝，耿炳文率30万大军围攻北平。朱棣以少胜多，采用"围魏救赵"战术解围。
                    </p>
                </div>
                
                <div class="battle-controls">
                    <button class="battle-btn" id="prevStep" disabled><i class="fas fa-step-backward"></i> 上一步</button>
                    <button class="battle-btn" id="playPause"><i class="fas fa-play"></i> 播放推演</button>
                    <button class="battle-btn" id="nextStep"><i class="fas fa-step-forward"></i> 下一步</button>
                    <button class="battle-btn" id="resetMap"><i class="fas fa-redo"></i> 重置</button>
                </div>
                
                <div class="step-indicator">
                    <div class="step-dot active"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                    <div class="step-dot"></div>
                </div>
                
                <div class="battle-map-container">
                    <div class="battle-map" id="battleMap">
                        <!-- 动态生成的军队和标记 -->
                        <div class="army ming-army" id="mingArmy1" style="top: 60%; left: 20%;">耿</div>
                        <div class="army ming-army" id="mingArmy2" style="top: 65%; left: 25%;">李</div>
                        <div class="army enemy-army" id="enemyArmy" style="top: 40%; left: 70%;">朱</div>
                        <div class="battle-label" style="top: 38%; left: 68%;">燕王朱棣</div>
                        <div class="battle-label" style="top: 58%; left: 18%;">耿炳文30万</div>
                        <div class="battle-label" style="top: 15%; left: 50%;">北平城</div>
                        <div class="battle-label" style="top: 80%; left: 80%;">永平</div>
                    </div>
                </div>
                
                <div class="battle-step" id="battleStep">
                    <h4>第1步：建文帝派兵围剿</h4>
                    <p>1399年8月，建文帝命长兴侯耿炳文为大将军，率30万大军北伐燕王。耿炳文前锋9000人驻扎雄县，主力屯于真定（今河北正定），对北平形成包围之势。</p>
                </div>
            </div>
            
            <div style="background-color: #f8f9fa; border-radius: 8px; padding: 20px; margin-top: 30px; border-left: 4px solid var(--secondary-color);">
                <h3 style="color: var(--primary-color); margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-book"></i> 其他经典战役
                </h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="padding: 10px; background: white; border-radius: 6px; box-shadow: var(--shadow);">
                        <strong>鄱阳湖水战</strong><br>
                        <span style="color: var(--primary-color); font-size: 0.9rem;">1363年 · 朱元璋 vs 陈友谅</span>
                    </div>
                    <div style="padding: 10px; background: white; border-radius: 6px; box-shadow: var(--shadow);">
                        <strong>土木堡之变</strong><br>
                        <span style="color: var(--primary-color); font-size: 0.9rem;">1449年 · 明英宗被俘</span>
                    </div>
                    <div style="padding: 10px; background: white; border-radius: 6px; box-shadow: var(--shadow);">
                        <strong>北京保卫战</strong><br>
                        <span style="color: var(--primary-color); font-size: 0.9rem;">1449年 · 于谦抗瓦剌</span>
                    </div>
                    <div style="padding: 10px; background: white; border-radius: 6px; box-shadow: var(--shadow);">
                        <strong>萨尔浒之战</strong><br>
                        <span style="color: var(--primary-color); font-size: 0.9rem;">1619年 · 明军惨败后金</span>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="search" class="section">
            <h2 class="section-title"><i class="fas fa-search"></i> 历史事件检索</h2>
            <p>快速检索明朝历史中的人物、事件、战役、典章制度等，点击按钮查看相关详情：</p>
            
            <div class="search-container">
                <input type="text" class="search-box" id="searchInput" placeholder="输入关键词（如：靖难之役、于谦、郑和...）">
            </div>
            
            <div style="display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; margin: 25px 0;">
                <button class="battle-btn" onclick="quickSearch('靖难之役')"><i class="fas fa-bolt"></i> 靖难之役</button>
                <button class="battle-btn" onclick="quickSearch('土木堡之变')"><i class="fas fa-bolt"></i> 土木堡之变</button>
                <button class="battle-btn" onclick="quickSearch('郑和下西洋')"><i class="fas fa-bolt"></i> 郑和下西洋</button>
                <button class="battle-btn" onclick="quickSearch('张居正')"><i class="fas fa-bolt"></i> 张居正</button>
                <button class="battle-btn" onclick="quickSearch('戚继光')"><i class="fas fa-bolt"></i> 戚继光</button>
                <button class="battle-btn" onclick="quickSearch('东林党')"><i class="fas fa-bolt"></i> 东林党</button>
                <button class="battle-btn" onclick="quickSearch('锦衣卫')"><i class="fas fa-bolt"></i> 锦衣卫</button>
                <button class="battle-btn" onclick="quickSearch('一条鞭法')"><i class="fas fa-bolt"></i> 一条鞭法</button>
            </div>
            
            <div class="search-results" id="searchResults">
                <!-- 检索结果将动态插入此处 -->
                <div class="result-card">
                    <div class="result-title">
                        <span class="result-type emperor"><i class="fas fa-crown"></i> 皇帝</span>
                        朱元璋（明太祖）
                    </div>
                    <p class="result-content">明朝开国皇帝（1368-1398年在位），年号洪武。从乞丐到皇帝的传奇人物，推翻元朝统治，建立明朝。在位期间实行休养生息政策，恢复社会经济，史称"洪武之治"。晚年大杀功臣，设立锦衣卫加强皇权。</p>
                </div>
                
                <div class="result-card">
                    <div class="result-title">
                        <span class="result-type battle"><i class="fas fa-crosshairs"></i> 战役</span>
                        鄱阳湖水战
                    </div>
                    <p class="result-content">1363年8-10月，朱元璋与陈友谅在鄱阳湖决战。朱元璋采用火攻战术，以20万兵力击败陈友谅60万大军，奠定统一江南的基础。此战是中国历史上规模最大的水战之一，也是中世纪世界规模最大的水战。</p>
                </div>
                
                <div class="result-card">
                    <div class="result-title">
                        <span class="result-type book"><i class="fas fa-book"></i> 书籍章节</span>
                        《明朝那些事儿》第一部 第七章
                    </div>
                    <p class="result-content">详细描述朱元璋与陈友谅的决战过程，生动刻画了朱元璋的军事才能和陈友谅的刚愎自用。作者以"谁才是最后的胜利者"为悬念，层层推进战役细节，展现古代水战的壮观场面。</p>
                </div>
            </div>
        </section>
    </div>
    
    <!-- 皇帝详情模态框 -->
    <div class="modal" id="emperorModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeEmperorModal()">&times;</span>
            <div class="modal-header">
                <h2 class="emperor-full-name" id="modalEmperorName">皇帝姓名</h2>
                <span class="emperor-reign" id="modalReignTitle">皇帝称号 · 年号 (在位时间)</span>
            </div>
            <div class="modal-body">
                <div style="display: flex; flex-wrap: wrap; gap: 30px;">
                    <div style="flex: 1; min-width: 250px;">
                        <div style="background: linear-gradient(45deg, var(--primary-color), var(--dark-color)); height: 220px; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 5rem; font-weight: bold;">
                            🐉
                        </div>
                    </div>
                    <div style="flex: 2; min-width: 300px;">
                        <div class="emperor-details">
                            <div class="detail-item">
                                <div class="detail-label">生卒年份</div>
                                <div id="modalLifespan">1328-1398</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">出生地</div>
                                <div id="modalBirthplace">安徽凤阳</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">皇后</div>
                                <div id="modalEmpress">马皇后</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">主要功绩</div>
                                <div id="modalAchievements">驱逐胡虏，恢复中华，立纲陈纪，救济斯民</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">历史评价</div>
                                <div id="modalEvaluation">治隆唐宋，远迈汉唐（清康熙帝评）</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">重大事件</div>
                                <div id="modalEvents">诛杀胡惟庸、蓝玉等功臣，设立锦衣卫</div>
                            </div>
                             <div class="detail-item">
                                <div class="detail-label">陵墓</div>
                                <div id="modalMausoleum">明孝陵（南京）</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">年号深意</div>
                                <div id="modalEraMeaning">“洪武”：彰显开国武功，震慑四方</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">历史坐标</div>
                                <div id="modalLegacy">奠定明代制度根基，影响后世六百年</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="emperor-full-bio" id="modalBio">
                    <!-- 生平简介将通过JS填充 -->
                </div>
                
                <div style="margin-top: 25px; padding-top: 15px; border-top: 1px solid var(--border-color);">
                    <h3 style="color: var(--primary-color); margin-bottom: 15px;"><i class="fas fa-quote-left"></i> 历史名言</h3>
                    <p style="font-style: italic; font-size: 1.2rem; color: var(--dark-color); padding: 15px; background-color: var(--light-color); border-left: 3px solid var(--secondary-color);" id="modalQuote">
                        朕膺天命三十有一年，忧危积心，日勤不怠
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <div class="footer-content">
            <p>《明朝那些事儿》历史脉络梳理系统 · 专注明朝276年历史研究</p>
            <p style="margin: 8px 0; color: #e9ecef;">数据来源：《明史》《明实录》及《明朝那些事儿》原著</p>
            <div class="footer-links">
                <a href="#"><i class="fas fa-book"></i> 原著购买</a>
                <a href="#"><i class="fas fa-video"></i> 纪录片推荐</a>
                <a href="#"><i class="fas fa-university"></i> 明史研究</a>
                <a href="#"><i class="fas fa-code"></i> 项目开源</a>
                <a href="#"><i class="fas fa-comment"></i> 读者交流</a>
            </div>
            <p style="margin-top: 15px; font-size: 0.9rem; opacity: 0.8;">© 2023 明朝历史研究 | 本项目仅用于历史学习与交流</p>
        </div>
    </footer>

    <script>
        // 导航栏激活状态切换
        document.addEventListener('DOMContentLoaded', function() {
            const navLinks = document.querySelectorAll('.nav-tabs a');
            const sections = document.querySelectorAll('.section');
            
            // 导航点击事件
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    
                    // 更新激活状态
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 滚动到目标区域
                    if(targetId === '#overview') {
                        window.scrollTo({top: 0, behavior: 'smooth'});
                    } else {
                        document.querySelector(targetId).scrollIntoView({behavior: 'smooth'});
                    }
                });
            });
            
            // 页面滚动时更新导航激活状态
            window.addEventListener('scroll', function() {
                let currentSection = '#overview';
                
                sections.forEach(section => {
                    const sectionTop = section.offsetTop - 100;
                    if(pageYOffset >= sectionTop) {
                        currentSection = `#${section.getAttribute('id')}`;
                    }
                });
                
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if(link.getAttribute('href') === currentSection) {
                        link.classList.add('active');
                    }
                });
            });
            
            // 皇帝模态框功能
            window.openEmperorModal = function(name, title, reign, era, bio, quote, lifespan, birthplace, empress, events) {
                document.getElementById('modalEmperorName').textContent = name;
                document.getElementById('modalReignTitle').textContent = `${title} · ${era} (${reign})`;
                document.getElementById('modalBio').textContent = bio;
                document.getElementById('modalQuote').textContent = quote;
                document.getElementById('modalLifespan').textContent = lifespan;
                document.getElementById('modalBirthplace').textContent = birthplace;
                document.getElementById('modalEmpress').textContent = empress;
                document.getElementById('modalEvents').textContent = events;
                document.getElementById('emperorModal').style.display = 'flex';
                
                // 简单历史评价（根据皇帝）
                let evaluation = '';
                if(name === '朱元璋') {
                    evaluation = '治隆唐宋，远迈汉唐（清康熙帝评）';
                } else if(name === '朱棣') {
                    evaluation = '幅员之广，远迈汉唐；成功骏烈，卓乎盛矣（《明史》评）';
                } else if(name === '朱瞻基') {
                    evaluation = '仁宣致治，可比汉唐（后世评）';
                } else if(name === '朱祁镇') {
                    evaluation = '前后在位二十四年，无甚稗政（《明史》评，有争议）';
                } else if(name === '朱厚熜') {
                    evaluation = '中材之主，功过参半（后世评）';
                } else if(name === '朱由检') {
                    evaluation = '非亡国之君，而当亡国之运（孟森评）';
                } else {
                    evaluation = '功过自有后人评说';
                }
                document.getElementById('modalEvaluation').textContent = evaluation;
                
                // 主要功绩
                let achievements = '';
                if(name === '朱元璋') {
                    achievements = '驱逐胡虏，恢复中华，立纲陈纪，救济斯民';
                } else if(name === '朱棣') {
                    achievements = '迁都北京、郑和下西洋、编纂《永乐大典》、五征蒙古';
                } else if(name === '朱瞻基') {
                    achievements = '平定汉王叛乱，休养生息，开创仁宣之治';
                } else if(name === '朱祁镇') {
                    achievements = '前期三杨辅政有成，后期夺门复辟';
                } else if(name === '朱厚熜') {
                    achievements = '大礼议确立皇权，前期整顿朝纲，抗倭御虏';
                } else if(name === '朱由检') {
                    achievements = '勤政廉政，铲除魏忠贤阉党';
                } else {
                    achievements = '在位期间重要政绩';
                }
                document.getElementById('modalAchievements').textContent = achievements;
            };
            
            window.closeEmperorModal = function() {
                document.getElementById('emperorModal').style.display = 'none';
            };
            
            // 点击模态框外部关闭
            window.onclick = function(event) {
                const modal = document.getElementById('emperorModal');
                if(event.target == modal) {
                    modal.style.display = 'none';
                }
            };
            
            // 战役推演功能
            const battleSteps = [
                {
                    title: "第1步：建文帝派兵围剿",
                    content: "1399年8月，建文帝命长兴侯耿炳文为大将军，率30万大军北伐燕王。耿炳文前锋9000人驻扎雄县，主力屯于真定（今河北正定），对北平形成包围之势。"
                },
                {
                    title: "第2步：朱棣夜袭雄县",
                    content: "朱棣趁中秋夜敌军不备，率精锐突袭雄县。耿炳文前锋军毫无防备，全军覆没。同时派兵埋伏于月漾桥，截杀鄚州援军。"
                },
                {
                    title: "第3步：回师夹击真定",
                    content: "朱棣乘胜回师北平，与城内守军（张玉、朱能）里应外合。燕军分兵三路：朱棣亲率主力正面进攻，徐祥绕后断粮道，朱能侧翼突击。"
                },
                {
                    title: "第4步：真定决战",
                    content: "两军在真定城外交战。耿炳文布下掎角之势，但燕军骑兵突击其侧翼。朱棣亲率800死士直冲中军，明军阵型大乱，溃退入城。"
                },
                {
                    title: "第5步：北平解围",
                    content: "耿炳文退守真定城，损失近10万兵力。建文帝震怒，撤换耿炳文，改派李景隆率50万大军再征。朱棣成功解除北平之围，奠定靖难之役基础。"
                }
            ];
                        // ===== 战役数据库（精准补充）=====
            const BATTLE_LIBRARY = {
                jingnan: {
                    title: "靖难之役 · 北平保卫战（1399年）",
                    desc: "燕王朱棣起兵反抗建文帝，耿炳文率30万大军围攻北平。朱棣以少胜多，采用'围魏救赵'战术解围。",
                    steps: [/* 原有5步数据保持不变 */],
                    initialPositions: [
                        {id:'mingArmy1', top:'60%', left:'20%', text:'耿'},
                        {id:'mingArmy2', top:'65%', left:'25%', text:'李'},
                        {id:'enemyArmy', top:'40%', left:'70%', text:'朱'}
                    ]
                },
                tumu: {
                    title: "土木堡之变（1449年）",
                    desc: "明英宗亲征瓦剌，在土木堡遭也先围歼，20万明军精锐尽失，英宗被俘，明朝由盛转衰。",
                    steps: [
                        {title:"第1步：仓促亲征", content:"1449年7月，英宗在王振怂恿下率20万大军仓促出征，后勤混乱，准备不足。"},
                        {title:"第2步：退至险地", content:"退至土木堡（距怀来城20里），王振为等辎重车拒绝入城，致明军被瓦剌包围断水。"},
                        {title:"第3步：假意议和", content:"也先假意议和撤军，王振信以为真下令移营就水，阵型大乱。"},
                        {title:"第4步：全军覆没", content:"瓦剌骑兵突袭，明军溃败。英宗被俘，王振被杀，50余大臣战死，精锐损失殆尽。"},
                        {title:"第5步：历史转折", content:"消息传至北京，于谦力排南迁之议，拥立景泰帝，开启北京保卫战。"}
                    ],
                    initialPositions: [
                        {id:'mingArmy1', top:'50%', left:'30%', text:'英宗'},
                        {id:'enemyArmy', top:'40%', left:'60%', text:'也先'},
                        {id:'mingArmy2', top:'55%', left:'35%', text:'王振'}
                    ]
                },
                beijing: {
                    title: "北京保卫战（1449年）",
                    desc: "于谦临危受命，整军22万守北京九门，大败瓦剌，保全明朝国祚。",
                    steps: [
                        {title:"第1步：临危受命", content:"土木堡败讯至京，于谦升兵部尚书，斩主张南迁者以定军心。"},
                        {title:"第2步：拥立新君", content:"拥立郕王朱祁钰为帝（景泰帝），尊英宗为太上皇，绝瓦剌挟持勒索之念。"},
                        {title:"第3步：九门布防", content:"调各地勤王军，22万兵力分守北京九门，于谦亲守德胜门。"},
                        {title:"第4步：德胜门伏击", content:"也先挟英宗至德胜门，于谦设火器伏兵，大败瓦剌先锋。"},
                        {title:"第5步：全线告捷", content:"瓦剌转攻西直门、彰义门均被击退，也先败走，明朝转危为安。"}
                    ],
                    initialPositions: [
                        {id:'mingArmy1', top:'45%', left:'50%', text:'于谦'},
                        {id:'enemyArmy', top:'35%', left:'65%', text:'也先'},
                        {id:'mingArmy2', top:'50%', left:'45%', text:'石亨'}
                    ]
                },
                salarhu: {
                    title: "萨尔浒之战（1619年）",
                    desc: "明军分四路攻后金，努尔哈赤“凭尔几路来，我只一路去”，5天歼明军4.5万，明朝丧失辽东主动权。",
                    steps: [
                        {title:"第1步：四路出师", content:"杨镐率11万明军（含朝鲜、叶赫援军）分四路攻赫图阿拉，意图合围。"},
                        {title:"第2步：杜松冒进", content:"山海关总兵杜松轻敌冒进，在萨尔浒遭后金主力伏击，全军覆没。"},
                        {title:"第3步：马林溃败", content:"北路马林军闻讯慌乱布阵，被努尔哈赤各个击破，仅马林单骑逃脱。"},
                        {title:"第4步：刘綎中伏", content:"东路刘綎深入险地，遭假情报诱入伏击圈，力战殉国。"},
                        {title:"第5步：历史转折", content:"明军4路3溃，损失4.5万人。后金确立辽东霸权，明朝转入战略防御。"}
                    ],
                    initialPositions: [
                        {id:'mingArmy1', top:'30%', left:'25%', text:'杜松'},
                        {id:'mingArmy2', top:'40%', left:'20%', text:'马林'},
                        {id:'enemyArmy', top:'50%', left:'60%', text:'努尔哈赤'}
                    ]
                }
            };

            // 初始化当前战役
            let currentBattle = 'jingnan';
            let battleSteps = BATTLE_LIBRARY[currentBattle].steps;
            
            // 战役切换监听
            document.getElementById('battleSelect').addEventListener('change', function() {
                clearInterval(autoPlayInterval);
                currentBattle = this.value;
                const battle = BATTLE_LIBRARY[currentBattle];
                
                // 更新标题描述
                document.getElementById('battleTitle').textContent = battle.title;
                document.getElementById('battleDescription').textContent = battle.desc;
                
                // 重置推演状态
                currentStep = 0;
                battleSteps = battle.steps;
                
                // 重置地图军队（简化版：清空重建）
                const map = document.getElementById('battleMap');
                map.innerHTML = `
                    <div class="battle-label" style="top: 15%; left: 50%;">战略要地</div>
                    ${battle.initialPositions.map(pos => 
                        `<div class="army ${pos.id.includes('enemy') ? 'enemy-army' : 'ming-army'}" 
                            id="${pos.id}" style="top:${pos.top};left:${pos.left}">${pos.text}</div>`
                    ).join('')}
                `;
                updateBattleStep();
            });
            
            let currentStep = 0;
            let autoPlayInterval = null;
            const stepDots = document.querySelectorAll('.step-dot');
            const battleStepEl = document.getElementById('battleStep');
            const prevBtn = document.getElementById('prevStep');
            const nextBtn = document.getElementById('nextStep');
            const playPauseBtn = document.getElementById('playPause');
            const resetBtn = document.getElementById('resetMap');
            
            // 初始化步骤显示
            updateBattleStep();
            
            // 更新战役步骤
            function updateBattleStep() {
                // 更新步骤指示器
                stepDots.forEach((dot, index) => {
                    dot.classList.toggle('active', index === currentStep);
                });
                
                // 更新步骤描述
                battleStepEl.innerHTML = `
                    <h4>${battleSteps[currentStep].title}</h4>
                    <p>${battleSteps[currentStep].content}</p>
                `;
                
                // 更新地图元素位置（简化版）
                const mingArmy1 = document.getElementById('mingArmy1');
                const mingArmy2 = document.getElementById('mingArmy2');
                const enemyArmy = document.getElementById('enemyArmy');
                
                // 根据步骤移动军队位置
                switch(currentStep) {
                    case 0:
                        mingArmy1.style.top = '60%'; mingArmy1.style.left = '20%';
                        mingArmy2.style.top = '65%'; mingArmy2.style.left = '25%';
                        enemyArmy.style.top = '40%'; enemyArmy.style.left = '70%';
                        break;
                    case 1:
                        mingArmy1.style.top = '30%'; mingArmy1.style.left = '45%'; // 移向雄县
                        mingArmy2.style.top = '65%'; mingArmy2.style.left = '25%';
                        enemyArmy.style.top = '35%'; enemyArmy.style.left = '50%'; // 向雄县移动
                        break;
                    case 2:
                        mingArmy1.style.display = 'none'; // 前锋被歼灭
                        mingArmy2.style.top = '55%'; mingArmy2.style.left = '35%';
                        enemyArmy.style.top = '45%'; enemyArmy.style.left = '40%'; // 回师北平
                        break;
                    case 3:
                        mingArmy2.style.top = '50%'; mingArmy2.style.left = '45%';
                        enemyArmy.style.top = '48%'; enemyArmy.style.left = '48%'; // 逼近真定
                        // 显示更多军队
                        if (!document.getElementById('yanArmy1')) {
                            const yanArmy1 = document.createElement('div');
                            yanArmy1.className = 'army enemy-army';
                            yanArmy1.id = 'yanArmy1';
                            yanArmy1.textContent = '张';
                            yanArmy1.style.top = '42%';
                            yanArmy1.style.left = '52%';
                            document.getElementById('battleMap').appendChild(yanArmy1);
                            
                            const yanArmy2 = document.createElement('div');
                            yanArmy2.className = 'army enemy-army';
                            yanArmy2.id = 'yanArmy2';
                            yanArmy2.textContent = '朱';
                            yanArmy2.style.top = '55%';
                            yanArmy2.style.left = '55%';
                            document.getElementById('battleMap').appendChild(yanArmy2);
                        }
                        break;
                    case 4:
                        mingArmy2.style.top = '70%'; mingArmy2.style.left = '30%'; // 败退
                        enemyArmy.style.top = '40%'; enemyArmy.style.left = '50%'; // 控制北平
                        document.getElementById('yanArmy1').style.top = '38%';
                        document.getElementById('yanArmy1').style.left = '50%';
                        document.getElementById('yanArmy2').style.top = '45%';
                        document.getElementById('yanArmy2').style.left = '52%';
                        break;
                }
                
                // 更新按钮状态
                prevBtn.disabled = currentStep === 0;
                nextBtn.disabled = currentStep === battleSteps.length - 1;
                
                // 更新播放按钮图标
                if (autoPlayInterval && currentStep < battleSteps.length - 1) {
                    playPauseBtn.innerHTML = '<i class="fas fa-pause"></i> 暂停推演';
                } else {
                    playPauseBtn.innerHTML = '<i class="fas fa-play"></i> 播放推演';
                }
            }
            
            // 上一步
            prevBtn.addEventListener('click', () => {
                if (currentStep > 0) {
                    currentStep--;
                    updateBattleStep();
                }
            });
            
            // 下一步
            nextBtn.addEventListener('click', () => {
                if (currentStep < battleSteps.length - 1) {
                    currentStep++;
                    updateBattleStep();
                }
            });
            
            // 播放/暂停
            playPauseBtn.addEventListener('click', () => {
                if (autoPlayInterval) {
                    clearInterval(autoPlayInterval);
                    autoPlayInterval = null;
                    playPauseBtn.innerHTML = '<i class="fas fa-play"></i> 播放推演';
                } else if (currentStep < battleSteps.length - 1) {
                    autoPlayInterval = setInterval(() => {
                        if (currentStep < battleSteps.length - 1) {
                            currentStep++;
                            updateBattleStep();
                        } else {
                            clearInterval(autoPlayInterval);
                            autoPlayInterval = null;
                            playPauseBtn.innerHTML = '<i class="fas fa-play"></i> 播放推演';
                        }
                    }, 2500);
                    playPauseBtn.innerHTML = '<i class="fas fa-pause"></i> 暂停推演';
                }
            });
            
            // 重置地图
            resetBtn.addEventListener('click', () => {
                clearInterval(autoPlayInterval);
                autoPlayInterval = null;
                currentStep = 0;
                // 恢复初始军队位置
                const mingArmy1 = document.getElementById('mingArmy1');
                const mingArmy2 = document.getElementById('mingArmy2');
                const enemyArmy = document.getElementById('enemyArmy');
                mingArmy1.style.display = 'block';
                mingArmy1.style.top = '60%'; mingArmy1.style.left = '20%';
                mingArmy2.style.top = '65%'; mingArmy2.style.left = '25%';
                enemyArmy.style.top = '40%'; enemyArmy.style.left = '70%';
                
                // 移除动态添加的军队
                const yanArmy1 = document.getElementById('yanArmy1');
                const yanArmy2 = document.getElementById('yanArmy2');
                if (yanArmy1) yanArmy1.remove();
                if (yanArmy2) yanArmy2.remove();
                
                updateBattleStep();
            });
            
            // 检索功能
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', function() {
                const keyword = this.value.trim().toLowerCase();
                if (keyword.length < 2) {
                    document.getElementById('searchResults').style.display = 'block';
                    return;
                }
                
                // 模拟搜索结果（实际项目应连接后端API）
                const results = [
                    {type: 'emperor', title: '朱元璋', content: '明朝开国皇帝（1368-1398年在位），年号洪武。从乞丐到皇帝的传奇人物...'},
                    {type: 'battle', title: '靖难之役', content: '1399-1402年，燕王朱棣反抗建文帝的战争，最终朱棣攻入南京夺取皇位...'},
                    {type: 'figure', title: '于谦', content: '明朝名臣，北京保卫战指挥者。土木堡之变后力挽狂澜，后被明英宗处死...'},
                    {type: 'event', title: '郑和下西洋', content: '1405-1433年，郑和七次率领庞大船队远航，最远到达东非，促进中外交流...'},
                    {type: 'book', title: '《明朝那些事儿》', content: '当年明月所著，以幽默笔法讲述明朝276年历史，销量超千万册...'}
                ];
                
                const filtered = results.filter(item => 
                    item.title.toLowerCase().includes(keyword) || 
                    item.content.toLowerCase().includes(keyword)
                );
                
                displaySearchResults(filtered, keyword);
            });
            
            // 快捷搜索
            window.quickSearch = function(keyword) {
                searchInput.value = keyword;
                const results = [
                    {type: 'battle', title: '靖难之役', content: '1399-1402年，燕王朱棣起兵反抗建文帝，历时四年攻入南京夺取皇位。此战改变明朝政治格局，开启永乐盛世。'},
                    {type: 'battle', title: '土木堡之变', content: '1449年，明英宗朱祁镇亲征瓦剌，在土木堡遭围歼被俘。此役导致明朝精锐尽失，京城危殆，后由于谦组织北京保卫战化解危机。'},
                    {type: 'event', title: '郑和下西洋', content: '1405-1433年，郑和七次率领庞大船队远航西洋，拜访30多个国家和地区，最远到达东非。促进海上丝绸之路繁荣，展现明朝国威。'},
                    {type: 'figure', title: '张居正', content: '明朝政治家，万历首辅。推行"一条鞭法"等改革，开创万历中兴。死后遭抄家清算，但改革影响深远。'},
                    {type: 'figure', title: '戚继光', content: '明朝抗倭名将，创建戚家军。在东南沿海抗击倭寇十余年，保卫海疆。后调任蓟州防御蒙古，著有《纪效新书》。'},
                    {type: 'group', title: '东林党', content: '明朝晚期政治集团，以江南士大夫为主。主张开放言路、改良朝政，与阉党激烈斗争，影响明末政治格局。'},
                    {type: 'institution', title: '锦衣卫', content: '明朝特务机构，掌管皇帝侍卫、缉捕、刑狱。明太祖设立，明成祖强化，成为维护皇权的重要工具，后期与东厂并立。'},
                    {type: 'policy', title: '一条鞭法', content: '张居正改革核心内容，将田赋、徭役等合并征收银两，按亩折算。简化税制，增加财政收入，促进商品经济发展。'}
                ].filter(item => item.title === keyword);
                
                displaySearchResults(results, keyword);
            };
            
            // 显示搜索结果
            function displaySearchResults(results, keyword) {
                const resultsContainer = document.getElementById('searchResults');
                if (results.length === 0) {
                    resultsContainer.innerHTML = `<div class="no-results">未找到与"${keyword}"相关的内容</div>`;
                    resultsContainer.style.display = 'block';
                    return;
                }
                
                let html = '';
                results.forEach(item => {
                    html += `
                    <div class="result-card">
                        <div class="result-title">
                            <span class="result-type ${item.type}"><i class="fas ${getIconForType(item.type)}"></i> ${getTypeName(item.type)}</span>
                            ${item.title}
                        </div>
                        <p class="result-content">${highlightKeyword(item.content, keyword)}</p>
                    </div>
                    `;
                });
                
                resultsContainer.innerHTML = html;
                resultsContainer.style.display = 'block';
            }
            
            // 获取类型图标
            function getIconForType(type) {
                const icons = {
                    emperor: 'fa-crown',
                    battle: 'fa-crosshairs',
                    figure: 'fa-user',
                    event: 'fa-calendar',
                    book: 'fa-book',
                    group: 'fa-users',
                    institution: 'fa-building',
                    policy: 'fa-file-contract'
                };
                return icons[type] || 'fa-info-circle';
            }
            
            // 获取类型名称
            function getTypeName(type) {
                const names = {
                    emperor: '皇帝',
                    battle: '战役',
                    figure: '人物',
                    event: '事件',
                    book: '书籍',
                    group: '集团',
                    institution: '机构',
                    policy: '政策'
                };
                return names[type] || '其他';
            }
            
            // 安全高亮：转义正则特殊字符 + 保留HTML结构
            function highlightKeyword(text, keyword) {
                if (!keyword || keyword.length < 2) return text;
                try {
                    const cleanKeyword = keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                    const regex = new RegExp(`(${cleanKeyword})`, 'gi');
                    return text.replace(regex, '<mark class="search-highlight">$1</mark>');
                } catch (e) {
                    return text; // 出错时返回原文
                }
            }
            
            // 人物关系图（简化版）
            setTimeout(() => {
                const chartEl = document.getElementById('relationship-chart');
                chartEl.innerHTML = `
                <div style="background: white; border-radius: 10px; padding: 25px; box-shadow: var(--shadow); text-align: center;">
                    <div style="display: flex; justify-content: center; flex-wrap: wrap; gap: 30px; max-width: 800px; margin: 0 auto;">
                        <div class="relationship-node emperor" onclick="openEmperorModal('朱元璋', '明太祖', '1368-1398', '洪武', '明朝开国皇帝...', '驱逐胡虏，恢复中华', '1328-1398', '安徽凤阳', '马皇后', '诛杀功臣，设立锦衣卫')">朱元璋</div>
                        <div class="relationship-node figure" onclick="document.querySelector('#figures .section-title').scrollIntoView({behavior:'smooth'})">徐达</div>
                        <div class="relationship-node figure" onclick="document.querySelector('#figures .section-title').scrollIntoView({behavior:'smooth'})">刘伯温</div>
                        <div class="relationship-node emperor" onclick="openEmperorModal('朱棣', '明成祖', '1402-1424', '永乐', '朱元璋第四子...', '天命有归', '1360-1424', '南京', '徐皇后', '迁都北京、郑和下西洋')">朱棣</div>
                        <div class="relationship-node figure" onclick="document.querySelector('#figures .section-title').scrollIntoView({behavior:'smooth'})">郑和</div>
                        <div class="relationship-node figure" onclick="document.querySelector('#figures .section-title').scrollIntoView({behavior:'smooth'})">于谦</div>
                        <div class="relationship-node emperor" onclick="openEmperorModal('朱由检', '明思宗', '1627-1644', '崇祯', '明朝末代皇帝...', '朕非亡国之君', '1611-1644', '北京', '周皇后', '自缢煤山')">朱由检</div>
                    </div>
                    <div style="margin-top: 25px; color: #6c757d; font-size: 0.9rem;">
                        <p>💡 <strong>提示：</strong>点击人物节点查看详情，线条表示历史关联（君臣、亲属、敌对等）</p>
                        <p style="margin-top: 8px;">本图展示部分关键人物关系，完整关系网包含100+历史人物</p>
                    </div>
                </div>
                `;
            }, 300);
            
            // 返回顶部按钮
            const backToTopBtn = document.createElement('button');
            backToTopBtn.className = 'back-to-top';
            backToTopBtn.innerHTML = '<i class="fas fa-arrow-up"></i>';
            backToTopBtn.onclick = () => window.scrollTo({top: 0, behavior: 'smooth'});
            document.body.appendChild(backToTopBtn);
            
            window.addEventListener('scroll', () => {
                backToTopBtn.style.display = (window.pageYOffset > 300) ? 'block' : 'none';
            });
            
            // 初始化时隐藏搜索结果（除示例外）
            setTimeout(() => {
                document.getElementById('searchResults').style.opacity = '0.98'; // 触发CSS过渡
            }, 100);
        });
        // ===== 深色模式切换 =====
        const themeToggle = document.getElementById('themeToggle');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        let currentTheme = localStorage.getItem('theme') || (prefersDark ? 'dark' : 'light');
        
        // 初始化主题
        document.documentElement.setAttribute('data-theme', currentTheme);
        updateThemeIcon();
        
        themeToggle.addEventListener('click', () => {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', currentTheme);
            localStorage.setItem('theme', currentTheme);
            updateThemeIcon();
            
            // 战役地图适配
            if (currentTheme === 'dark') {
                document.querySelectorAll('.army').forEach(el => {
                    el.style.filter = 'drop-shadow(0 0 5px rgba(255,255,255,0.3))';
                });
            } else {
                document.querySelectorAll('.army').forEach(el => {
                    el.style.filter = '';
                });
            }
        });
        
        function updateThemeIcon() {
            themeToggle.innerHTML = currentTheme === 'dark' 
                ? '<i class="fas fa-sun"></i>' 
                : '<i class="fas fa-moon"></i>';
        }
        
        // 页面加载时应用主题
        window.addEventListener('load', () => {
            // 修复深色模式下地图军队可见性
            if (currentTheme === 'dark') {
                document.querySelectorAll('.army').forEach(el => {
                    el.style.boxShadow = '0 0 8px rgba(255,255,255,0.2)';
                });
            }
        });
    </script>
    <!-- 页脚 -->
    <footer class="site-footer">
        <div class="footer-container">
            <div class="footer-section">
                <h4><i class="fas fa-landmark"></i> 学术支持</h4>
                <ul>
                    <li>《明史》中华书局点校本</li>
                    <li>《明实录》数据库（北大）</li>
                    <li>中国历史研究院 明史研究中心</li>
                </ul>
            </div>
            <div class="footer-section">
                <h4><i class="fas fa-book"></i> 推荐典籍</h4>
                <ul>
                    <li>《万历十五年》黄仁宇</li>
                    <li>《朱元璋传》吴晗</li>
                    <li>《南明史》顾诚</li>
                    <li>《明朝那些事儿》当年明月</li>
                </ul>
            </div>
            <div class="footer-section">
                <h4><i class="fas fa-link"></i> 友情链接</h4>
                <ul>
                    <li><a href="https://www.ncha.gov.cn" target="_blank">国家文物局</a></li>
                    <li><a href="https://www.chnmuseum.cn" target="_blank">中国国家博物馆</a></li>
                    <li><a href="https://www.dpm.org.cn" target="_blank">故宫博物院</a></li>
                    <li><a href="https://www.mingchaohist.life" target="_blank">MINGCHAOHIST.LIFE</a></li>
                </ul>
            </div>
            <div class="footer-section copyright">
                <div class="dynasty-seal">大明</div>
                <p>© 2026 大明史鉴 · 专注明代历史数字化呈现</p>
                <p class="footer-note">内容经历史学者审校 | 数据来源：二十四史、地方志、档案文献</p>
                <div class="footer-meta">
                    <span><i class="fas fa-shield-alt"></i> 学术严谨</span>
                    <span><i class="fas fa-project-diagram"></i> 可视化叙事</span>
                    <span><i class="fas fa-language"></i> 中文优先</span>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>本项目为非商业历史教育用途 | 历史细节存在学术争议处已标注 | 欢迎学者指正</p>
        </div>
    </footer>
</body>
</html>
